{
    "componentChunkName": "component---src-templates-mdx-js",
    "path": "/community/core/docs/adr/0005-obtimizing-keb-runs.md",
    "result": {"data":{"site":{"siteMetadata":{"title":"Thoth Station Help"}},"mdx":{"id":"47a58a10-c48b-5c01-85be-8ed872e4bf3f","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"{short title of solved problem and solution}\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Status: proposed\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Deciders: @KPostOffice @fridex @cgoern \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Date: 2022-3-15 when the decision was last updated} \")), mdx(\"p\", null, \"Technical Story: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/thoth-station/kebechet/issues/873\"\n  }, \"Kebechet#873\")), mdx(\"h2\", null, \"Context and Problem Statement\"), mdx(\"p\", null, \"Kebechet is being run too often and is eagerly eating resources in cluster. We need to pare down how often we spin up\\npods to do repository management.\"), mdx(\"h2\", null, \"Decision Drivers \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Less pods being spun up.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Reduce frequency of reaching GitHub API quota limit\")), mdx(\"h2\", null, \"Considered Options\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Option 1: Filter web-hooks in thoth-user-api\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Option 2: Create Kebechet deployment receives web-hooks and only runs specific manager(s) depending on contents\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Option 3: Create individual repositories and GitHub applications for each manager\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Option 4: create GitHub app for each repo and choose auth at run time\")), mdx(\"h2\", null, \"Decision Outcome\"), mdx(\"p\", null, \"Chosen option: \\u201Coption 3\\u201D, because we can use existing bot frameworks and github event handlers such as\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"gidgethub\"), \"(Python) and \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"probot\"), \"(JavaScript). This should help reduce cluster load as pods will be shorter lived and\\nless frequent, however, it does require multiple small deployments for handling web-hooks.\"), mdx(\"p\", null, \"Implementing option 2 and option 4 might be another good solution.\"), mdx(\"h3\", null, \"Positive Consequences \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Reduced resource consumption\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"More apps means more quota\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Each app\\u2019s behavior is well defined. It\\u2019s at times unclear what \\u201CKebechet\\u201D is\")), mdx(\"h3\", null, \"Negative Consequences \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Follow up decisions required: \\u201CWhat technologies do we use?\\u201D, \\u201CHow do we manage configuration?\\u201D\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Transition from maintaining list of managers to installing individual managers\")), mdx(\"h2\", null, \"Pros and Cons of the Options \"), mdx(\"h3\", null, \"Option 1: Filter web-hooks in thoth-user-api\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, because it requires minimal upfront work\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bad, because it introduces tight coupling between Kebechet and user-api\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bad, because GitHub already only sends a subset of events and it is likely that we would not see a major decrease in\\nresource consumption.\")), mdx(\"h3\", null, \"Option 2: Create Kebechet deployment receives web-hooks and only runs specific manager(s) depending on contents\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, because it allows for thorough processing of events prior to pod being spun up\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, it can still run multiple bots in the same pod (depends on implementation)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"?, Preserves Kebechet name recognition (may obfuscate functionality)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bad, does not help with reducing GitHub API quota consumption\")), mdx(\"h3\", null, \"Option 3: Create individual repositories and GitHub applications for each manager\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, because it creates more apps which effectively increases the total API limit\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, segregating functionality helps users understand what they are installing\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, workloads can be very selectively run through thorough web-hook processing\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bad, many small deployments\")), mdx(\"h3\", null, \"Option 2&4: Create Keb deployment and Individual apps\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, because it creates more apps which effectively increases the total API limit\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good?, single deployment\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Good, workloads can be very selectively run through thorough web-hook processing\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bad, installation story becomes unclear\")));\n}\n;\nMDXContent.isMDXComponent = true;","fields":{"srcLink":"https://github.com/thoth-station/core/blob/master/docs/adr/0005-obtimizing-keb-runs.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"47a58a10-c48b-5c01-85be-8ed872e4bf3f"}},
    "staticQueryHashes": ["1276261476","2902925331","3000541721","489485899"]}